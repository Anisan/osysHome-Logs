# Logs - Модуль просмотра логов

![Logs Icon](static/Logs.png)

Система просмотра и мониторинга логов для просмотра системных логов, отслеживания ошибок и управления файлами логов.

## Описание

Модуль `Logs` предоставляет интерфейс просмотра логов для платформы osysHome. Он позволяет просматривать системные логи, отслеживать ошибки и мониторить файлы логов через веб-интерфейс.

## Основные возможности

- ✅ **Просмотр файлов логов**: Просмотр любых файлов логов из директории `logs`
- ✅ **Умная загрузка**: Загрузка только первых или последних N строк (для больших файлов)
- ✅ **Разбор записей**: Преобразование сырого текста в структурированные записи (время, уровень, модуль, сообщение)
- ✅ **Фильтрация**:
  - по тексту в сообщениях,
  - по уровню логов (INFO/ERROR и др.),
  - по модулю.
- ✅ **Сортировка**: Сортировка записей по времени (по возрастанию/убыванию)
- ✅ **Многострочные сообщения**: Сворачивание/разворачивание многострочных записей (трейсы, длинные payload’ы)
- ✅ **Счетчики строк и записей**: Отображение `загружено / всего` строк и количества разобранных записей для каждого файла
- ✅ **Поддержка виджетов**: Виджет панели управления с количеством ошибок (с тем же regex, что и в просмотрщике)
- ✅ **Интеграция API**: RESTful API для доступа к логам и частичной загрузки

## Панель администратора

Модуль предоставляет Vue‑интерфейс администратора:

### Главный вид
- **Список файлов логов** (левая колонка)
  - Отсортированы по времени изменения (новые сверху)
  - Фильтр по имени и варианты сортировки (имя, размер, время изменения)
  - Чекбоксы для выбора нескольких файлов
  - Прокручиваемый список, «вписанный» в высоту окна
- **Область содержимого** (правая колонка)
  - Отдельная карточка для каждого выбранного файла
  - Панель действий для файла: перезагрузка, скачивание, сворачивание содержимого
  - Счетчики: загруженные строки / всего строк, количество записей после парсинга

### Отображение логов
- Записи парсятся тем же регулярным выражением на сервере и на клиенте:

  ```text
  ^(\d{2}:\d{2}:\d{2}(?:\.\d{3})?)\[(INFO|ERROR|DEBUG|WARNING|CRITICAL)](?:\[([^\]]*)])*([^\n\r]*)
  ```

- Каждая запись отображает:
  - время,
  - уровень (badge с цветом),
  - необязательный модуль,
  - сообщение (однострочное или многострочное со сворачиванием).
- Очень длинные «неразрывные» строки (например base64‑данные) переносятся, не ломая верстку.

## Виджет

Модуль предоставляет виджет панели управления, показывающий:
- **Количество ошибок**: Количество записей об ошибках в `errors.log`  
  (подсчет по тому же regex, что и в просмотрщике, чтобы цифры совпадали)
- **Статус ошибок**: Визуальный индикатор при наличии ошибок
- **Ссылка**: Прямая ссылка на модуль Logs
  - При клике открывает страницу Logs
  - Файл `errors.log` автоматически выбирается и загружается

## API

Модуль предоставляет RESTful API endpoints для программного доступа к логам:

- **GET /api/logs/...**: Доступ к файлам логов через API

## Использование

### Просмотр логов

1. Перейдите в модуль Logs в панели администратора.
2. Выберите один или несколько файлов логов в списке слева.
3. Используйте фильтры содержимого справа:
   - текстовый фильтр,
   - сортировка по времени (возр./убыв.),
   - фильтры по модулю и уровню.
4. Для больших файлов:
   - загружается только часть строк (первые или последние N строк),
   - на карточке отображается, сколько строк загружено и сколько всего в файле,
   - при усечении выводится предупреждение.
5. Нажимайте на помеченные `(click)` многострочные сообщения, чтобы разворачивать/сворачивать детали.

### Мониторинг ошибок

Виджет автоматически отслеживает ошибки в `errors.log`:
- Количество ошибок отображается на панели управления (подсчет совпадает с просмотрщиком)
- Визуальный индикатор при наличии ошибок
- Нажмите на виджет, чтобы открыть Logs с уже выбранным `errors.log`

## Технические детали

- **Директория логов**: Папка `logs/`
- **Лог ошибок**: Файл `errors.log`
- **Шаблон записи**: Regex-шаблон для обнаружения записей лога
- **Кодировка**: UTF-8 с обработкой ошибок

## Версия

Текущая версия: **1.0**

## Категория

System

## Действия

Модуль предоставляет следующие действия:
- `widget` - Виджет панели управления с количеством ошибок

## Требования

- Flask
- Основная система osysHome

## Автор

Команда osysHome

## Лицензия

См. лицензию основного проекта osysHome

