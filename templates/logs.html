{% extends "layouts/module_admin.html" %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="Logs">{{ _('Logs')}}</a></li>
{% endblock %}

{% block module %}
<style>
  /* –°–∫—Ä—ã–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Vue */
  [v-cloak] {
    position: relative;
    min-height: 200px;
  }
  [v-cloak] > * {
    display: none !important;
  }
  /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –ø–æ–∫–∞ v-cloak –∞–∫—Ç–∏–≤–µ–Ω */
  [v-cloak]::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 3rem;
    height: 3rem;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0d6efd;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    display: block;
    z-index: 1000;
  }
  @keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
  }
</style>
<div id="logs_module" class="container-fluid p-0" v-cloak>
    <div class="row h-100">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ + —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div class="col-auto border-end pe-2 d-flex flex-column" style="max-height: calc(100vh - 130px); overflow-y: auto;">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h4 class="mb-0">{{ _('Logs')}}</h4>
          <button  class="btn btn-outline-primary btn-sm d-flex align-items-center" type="button" @click="fetchLogs()">
              <span class="fas fa-rotate" :class="{ 'fa-spin' : loading }"></span>
          </button>
        </div>
        <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∏–º–µ–Ω–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
        <div class="search-bar d-flex gap-2 mb-2">
            <input
              v-model="filter"
              type="text"
              class="form-control form-control-sm"
              :placeholder="'{{ _('Search filename...')}}'"
            />
            <select
              v-model="sortBy"
              class="form-select form-select-sm"
            >
              <option v-for="item in sortOptions" :value="item.value">[[item.text]]</option>
            </select>
        </div>
        <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
        <ul class="list-group flex-grow-1 overflow-auto">
            <li
                v-for="(file, index) in filteredAndSortedFiles"
                :key="index"
                class="list-group-item list-group-item-action"
                @click="setSelection(file)"
            >
                <div class="d-flex w-100 justify-content-between align-items-center">
                    <div style="cursor: pointer">
                        <input class="form-check-input me-2" type="checkbox" :checked="isSelected(file.name)" @click.stop="toggleSelection(file)">
                        [[ file.name ]]
                    </div>
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-danger"
                      @click.stop="confirmDelete(file)"
                    >
                      <i class="feather icon-trash"></i>
                    </button>
                </div>
                <small class="text-muted">[[ formatSize(file.size) ]] | [[ formatDate(file.modified) ]]</small>
            </li>
        </ul>
      </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="col flex-grow-1">
            <h4>{{ _('Content')}}</h4>
            <div v-if="selectedLogs.length > 0">
              <div class="search-bar row">
                <div class="col-auto">
                  <div class="input-group mb-1">
                    <span class="input-group-text"><i class="fas fa-filter"></i></span>
                    <input type="text" v-model="searchQuery" class="form-control" placeholder="{{ _('Filter...')}}">
                    <button class="btn btn-outline-secondary" type="button" @click="clearContentFilter">
                      <i class="fas fa-times me-1"></i>
                    </button>
                  </div>
                    <label class="form-label mb-1">{{ _('Sort by...')}}</label>
                    <select
                        v-model="sortOrder"
                        class="form-select mb-1"
                        placeholder="{{ _('Sort by...')}}"
                    >
                        <option value="asc">{{ _('Time')}} üîº</option>
                        <option value="desc">{{ _('Time')}} üîΩ</option>
                    </select>
                </div>
                <div class="col">
                    <label v-if="modules.length > 0" class="form-label mb-1">{{ _('Filter by modules...')}}</label>
                    <div v-if="modules.length > 0" class="mb-0">
                        <div v-for="item in modules" class="badge me-1 p-1" :class="selectedModules.includes(item) ? 'bg-primary':'bg-light text-dark'" @click="toggleModule(item)">[[item]]</div>
                    </div>
                    <label class="form-label  mb-0">{{ _('Filter by level...')}}</label>
                    <div>
                        <div v-for="item in levels" class="badge me-1 p-1" :class="selectedLevels.includes(item.value) ? 'bg-'+item.color:'bg-light text-dark'" @click="toggleLevel(item.value)">[[item.value]]</div>
                    </div>
                </div>
            </div>
              <div v-for="(log, index) in selectedLogs" :key="index" class="rounded border shadow-sm p-2 mb-3 d-flex flex-column">
                <div class="d-flex align-items-center mb-2">
                  <div class="d-flex align-items-center flex-grow-1">
                    <a class="link" @click="fetchLogFileContent(log.name)">
                        <span class="fas fa-rotate" :class="{ 'fa-spin' : log.loading }"></span>
                    </a>
                    <div class="mx-3 mt-2 mb-0 flex-grow-1 text-truncate">
                      <h5 class="mb-0 text-truncate">
                        [[ log.name ]]
                        <small
                          v-if="log.loadedLines && log.totalLines && log.content"
                          class="text-muted ms-2"
                        >
                          [[ log.loadedLines ]] / [[ log.totalLines ]] {{ _('lines') }},
                          [[ log.content.length ]] {{ _('entries') }}
                        </small>
                      </h5>
                    </div>
                  </div>
                  <div class="d-flex align-items-center gap-2">
                    <small v-if="log.truncated" class="text-muted d-none d-md-inline">
                      {{ _('Only part of the log is loaded') }}
                    </small>
                    <a
                      class="btn btn-sm btn-outline-secondary"
                      :href="downloadHref(log.name)"
                      @click.stop
                    >
                      <i class="feather icon-download"></i>
                    </a>
                    <a class="link" @click.stop="log.collapse = !log.collapse">
                        <span class="fas" :class="log.collapse ? 'fa-chevron-up' : 'fa-chevron-down'"></span>
                    </a>
                  </div>
                </div>
                <div v-show="!log.collapse" class="overflow-auto rounded border p-2 min-vh-0">
                  <div v-if="log.truncated" class="alert alert-warning py-1 px-2 mb-2">
                    {{ _('Only part of the log is loaded. Use download to get full file.') }}
                  </div>
                  <div
                    v-for="(line, lineIndex) in filteredAndSortedLogEntries(log)"
                    :key="lineIndex"
                    :class="['d-flex align-items-start border-bottom p-1 small', { 'border-bottom-0': lineIndex === filteredAndSortedLogEntries(log).length - 1 }]"
                  >
                    <span class="d-flex align-items-center gap-1 me-2 small">
                      <span class="text-body-secondary font-monospace">[[ line.time ]]</span>
                      <span :class="'badge ms-1 me-1 bg-'+line.color">[[line.level]]</span>
                      <span v-if="line.module" class="badge bg-primary">[[line.module]]</span>
                    </span>
                    <span class="flex-grow-1">
                      <span v-if="!line.isMultiline" class="font-monospace small text-break" style="white-space: pre-wrap">[[ line.message ]]</span>
                      <span v-else>
                        <span v-if="!line.isExpanded" class="link-primary text-decoration-underline" style="cursor: pointer" @click="toggleMultiline(line)">
                          [[ line.message.split('\n')[0] ]]... ({{ _('click') }})
                        </span>
                        <pre v-else class="font-monospace small text-break mb-0" style="white-space: pre-wrap; cursor: pointer" @click="toggleMultiline(line)" title="{{ _('Click to collapse') }}">[[ line.message ]]</pre>
                      </span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <p v-else class="text-muted">{{ _('Select file for view.')}}</p>
          </div>
    </div>
    </div>
  </div>
</div>
<script src="{{ config.ASSETS_ROOT }}/plugins/vue/vue@2.js"></script>
<script src="{{ config.ASSETS_ROOT }}/plugins/vue/axios.min.js"></script>
<script>
    new Vue({
      el: '#logs_module',
      delimiters: ['[[', ']]'], // –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
      data: {
        search: '',
        sortKey: 'runtime',
        sortAsc: true,
        files: [],
        loading: false,
        error: null,
        filter: "", // –§–∏–ª—å—Ç—Ä –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        sortBy: "name", // –¢–µ–∫—É—â–∏–π –º–µ—Ç–æ–¥ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        sortOptions: [
            { value: "name", text: "{{ _('Filename')}} üîº" },
            { value: "-name", text: "{{ _('Filename')}} üîΩ" },
            { value: "size", text: "{{ _('Size')}} üîº" },
            { value: "-size", text: "{{ _('Size')}} üîΩ" },
            { value: "modified", text: "{{ _('Updated')}} üîº" },
            { value: "-modified", text: "{{ _('Updated')}} üîΩ" },
        ],
        selectedLogs: [], // –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
        searchQuery:'',
        sortOrder:'asc',
        selectedLevels:[],
        levels:[
            {value:'UNKNOWN', color:"primary"},
            {value:'DEBUG', color:"secondary"},
            {value:'INFO', color:"success"},
            {value:'WARNING', color:"warning"},
            {value:'ERROR', color:"danger"},
            {value:'CRITICAL', color:"danger"},
        ],
        modules:[],
        selectedModules:[],
      },
      async created() {
        await this.fetchLogs()
      },
      mounted() {
        if (localStorage.log_filter_file) {
          this.filter = localStorage.log_filter_file;
        }
        if (localStorage.log_filter_content) {
          this.searchQuery = localStorage.log_filter_content;
        }
        if (localStorage.log_sortBy_files) {
          this.sortBy = localStorage.log_sortBy_files;
        }
        if (localStorage.log_sort_order) {
          this.sortOrder = localStorage.log_sort_order;
        }
      },
      watch: {
        filter(value) {
          localStorage.log_filter_file = value;
        },
        searchQuery(value) {
          localStorage.log_filter_content = value;
        },
        sortBy(value) {
          localStorage.log_sortBy_files = value;
        },
        sortOrder(value) {
          localStorage.log_sort_order = value;
          // –ü—Ä–∏ —Å–º–µ–Ω–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ª–æ–≥–∏,
          // —á—Ç–æ–±—ã —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–¥—Ç—è–Ω—É—Ç—å –Ω–∞—á–∞–ª–æ –∏–ª–∏ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ—Ä—è–¥–∫–æ–º.
          this.selectedLogs.forEach(log => {
            this.fetchLogFileContent(log.name);
          });
        },
      },
      computed: {
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –∏–º–µ–Ω–∏
        filteredFiles() {
            if (this.files.length == 0)
                return []
            return this.files.filter((file) =>
                file.name.toLowerCase().includes(this.filter.toLowerCase())
            );
        },
        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        filteredAndSortedFiles() {
            return [...this.filteredFiles].sort((a, b) => {
                if (this.sortBy === "name") {
                return a.name.localeCompare(b.name);
                }else if (this.sortBy === "-name") {
                return b.name.localeCompare(a.name);
                } else if (this.sortBy === "size") {
                return a.size - b.size;
                } else if (this.sortBy === "-size") {
                return b.size - a.size;
                } else if (this.sortBy === "modified") {
                return new Date(b.modified) - new Date(a.modified);
                } else if (this.sortBy === "-modified") {
                return new Date(a.modified) - new Date(b.modified);
                }
                return 0;
            });
            },
        filteredData() {
          let data = this.tasks;
          if (this.search) {
            data = data.filter(row =>
              Object.values(row).some(val =>
                String(val).toLowerCase().includes(this.search.toLowerCase())
              )
            );
          }
          if (this.sortKey) {
            data = data.slice().sort((a, b) => {
              let aVal = a[this.sortKey];
              let bVal = b[this.sortKey];
  
              if (aVal < bVal) return this.sortAsc ? -1 : 1;
              if (aVal > bVal) return this.sortAsc ? 1 : -1;
              return 0;
            });
          }
          return data;
        },
      },
      methods: {
        clearContentFilter() {
          this.searchQuery = '';
          this.selectedLevels = [];
          this.selectedModules = [];
        },
        fetchLogs() {
          this.loading = true
          axios.get(`/api/logs/list`)
            .then(response => {
            console.log(response.data)
              this.files = response.data.result
              this.loading = false
              try {
                const params = new URLSearchParams(window.location.search);
                const initialFile = params.get('file');
                if (initialFile && this.selectedLogs.length === 0) {
                  const file = this.files.find(f => f.name === initialFile);
                  if (file) {
                    this.setSelection(file);
                  }
                }
              } catch (e) {
                console.warn('Failed to apply initial file selection from URL params', e);
              }
            })
            .catch(error => {
              console.log(error)
              this.error = error
              this.loading = false
            })
            ;
        },
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        toggleSelection(file) {
            console.log("togle",file)
            const existingIndex = this.selectedLogs.findIndex((log) => log.name === file.name);
            if (existingIndex !== -1) {
                this.selectedLogs.splice(existingIndex, 1); // –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
            } else {
                this.selectedLogs.push({ ...file, content: [], loading: false, collapse:false }); // –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª
                this.fetchLogFileContent(file.name);
            }
        },
        setSelection(file){
            console.log("set",file)
            const existingIndex = this.selectedLogs.findIndex((log) => log.name === file.name);
            this.selectedLogs = []
            this.selectedLogs.push({ ...file, content: [], loading: false, collapse:false }); // –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª
            this.fetchLogFileContent(file.name);
        },
        toggleLevel(level){
            if (this.selectedLevels.includes(level)) 
                this.selectedLevels = this.selectedLevels.filter(item => item !== level);
            else 
                this.selectedLevels.push(level);
        },
        toggleModule(module){
            if (this.selectedModules.includes(module)) 
                this.selectedModules = this.selectedModules.filter(item => item !== module);
            else 
                this.selectedModules.push(module);
        },
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—ã–±—Ä–∞–Ω –ª–∏ —Ñ–∞–π–ª
        isSelected(filename) {
            return this.selectedLogs.some((log) => log.name === filename);
        },
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        toggleMultiline(line) {
            line.isExpanded = !line.isExpanded;
        },
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ (—á–∞—Å—Ç–∏—á–Ω–æ, –¥–ª—è –±–æ–ª—å—à–∏—Ö –ª–æ–≥–æ–≤)
        fetchLogFileContent(filename) {
            var parsedModules = [];
            const log = this.selectedLogs.find((log) => log.name === filename);
            if (log) {
                    log.loading = true
            }
            const MAX_LINES = 3000;
            const position = this.sortOrder === 'asc' ? 'start' : 'end';
            axios.get(`/api/logs/${filename}`, {
                params: {
                    lines: MAX_LINES,
                    position: position,
                },
            }).then((response) => {
                const rawContent = response.data.result || ''
                const content = rawContent.split('\n')
                let loadedLines = content.length
                if (loadedLines > 0 && content[loadedLines - 1] === '') {
                    loadedLines -= 1
                }
                // –ü–∞—Ä—Å–∏–º –ª–æ–≥–∏ —Å —É—á–µ—Ç–æ–º –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ—Å—Ç–∏
                const parsedLogs = [];
                let currentLog = null;

                const regex = /^(\d{2}:\d{2}:\d{2}(?:\.\d{3})?)\[(INFO|ERROR|DEBUG|WARNING|CRITICAL)](?:\[([^\]]*)])*([^\n\r]*)/m;

                content.forEach((line) => {
                  const match = line.match(regex);
                  if (match) {
                    if (currentLog) {
                        parsedLogs.push(currentLog);
                    }
                    const category = match ? match[2] : "UNKNOWN";
                    var color = 'primary'
                    if (category == 'DEBUG') color='secondary'
                    else if (category == 'INFO') color='success'
                    else if (category == 'WARNING') color='warning'
                    else if (category == 'ERROR') color='danger'
                    else if (category == 'CRITICAL') color='danger'
                    if (match[3]) {
                      if (!parsedModules.includes(match[3]))
                        parsedModules.push(match[3])
                    }
                    currentLog = {
                        color: color,
                        time: match[1],
                        level: category,
                        module: match[3],
                        message: match[4].trim(),
                        isMultiline: false,
                        isExpanded: false,
                    }
                  } else {
                    // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ª–æ–≥–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É
                    if (currentLog && line !="") {
                        currentLog.message += `\n${line}`;
                        currentLog.isMultiline = true
                    }
                  }
                });

                if (currentLog) {
                    parsedLogs.push(currentLog);
                }
                this.modules = parsedModules;
                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Ö –∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞
                if (Array.isArray(this.selectedModules) && this.selectedModules.length > 0) {
                  this.selectedModules = this.selectedModules.filter((m) => parsedModules.includes(m));
                }

                if (log) {
                    log.content = parsedLogs;
                    // —Å–µ—Ä–≤–µ—Ä —Å–æ–æ–±—â–∞–µ—Ç, –±—ã–ª–∞ –ª–∏ –æ—Ç–¥–∞–Ω–∞ —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞
                    log.truncated = !!response.data.truncated;
                    log.loadedLines = loadedLines;
                    log.totalLines = response.data.total_lines || loadedLines;
                    log.loading = false
                }
            });
        },
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        formatSize(size) {
            const kb = size / 1024;
            return `${kb.toFixed(2)} KB`;
        },
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        },
        sortBy(key) {
            if (this.sortKey === key) {
                this.sortAsc = !this.sortAsc;
            } else {
                this.sortKey = key;
                this.sortAsc = true;
            }
        },
        getSortClass(key) {
            if (this.sortKey === key) {
                return this.sortAsc ? 'sortable asc' : 'sortable desc';
            } else {
                return '';
            }
        },
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–æ–≤
        filteredAndSortedLogEntries(log) {
          return log.content
            .filter((line) =>
              line.message.toLowerCase().includes(this.searchQuery.toLowerCase()) &&
              (this.selectedLevels.length === 0 || this.selectedLevels.includes(line.level))
            )
            .filter((line) =>
              line.module == undefined || 
              (line.module &&
              (this.selectedModules.length === 0 || this.selectedModules.includes(line.module)))
            )
            .sort((a, b) => {
              const timeA = a.time.replace(/:/g, '');
              const timeB = b.time.replace(/:/g, '');
              if (this.sortOrder === 'asc') {
                return timeA.localeCompare(timeB);
              } else if (this.sortOrder === 'desc') {
                return timeB.localeCompare(timeA);
              }
              return 0;
            });
        },
        downloadHref(name) {
          return `/api/logs/${encodeURIComponent(name)}/download`;
        },
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        confirmDelete(file) {
            if (window.confirm(`Are you sure you want to delete the file "${file.name}"?`)) {
                this.deleteFile(file);
            }
        },
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        deleteFile(file) {
            axios.delete(`/api/logs/${file.name}`).then((response) => {
                const result = response.data.success
                if (result) {
                    // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞
                    const index = this.files.findIndex((f) => f.name === file.name);
                    if (index !== -1) {
                      this.files.splice(index, 1);
                    }
                    // –ò –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ —Å–ø—Ä–∞–≤–∞
                    const selectedIndex = this.selectedLogs.findIndex((log) => log.name === file.name);
                    if (selectedIndex !== -1) {
                      this.selectedLogs.splice(selectedIndex, 1);
                    }
                }
            })
        },
      }
    });
  </script>
{% endblock %}